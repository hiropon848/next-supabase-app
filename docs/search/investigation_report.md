# 調査報告: スラッシュコマンド候補にワークフローが表示されない件

ご依頼いただいた事象について、システムおよびGit設定の観点から調査を行いました。以下に詳細な原因と対策を報告します。

## 1. 根本原因

**結論: `.gitignore` の設定により、システムがファイルを「無視（不可視）」として扱っているためです。**

今回発生している事象は、システムのインデックス作成プロセスが `.gitignore` の設定（「無視ファイル」の定義）を尊重していることに起因します。

### 詳細な動作原理
1.  **以前の状態 (`clear_old_verification_images.md`)**:
    - `.gitignore` の 38行目で `.agent/*`（全無視）が設定されていました。
    - しかし、39行目で `!.agent/workflows/`（このディレクトリは例外として許可）が設定されていました。
    - 以前のファイル名に対する個別の無視設定は存在しなかったため、このファイルは**システムから「見える」状態**であり、スラッシュコマンドとして認識されていました。
2.  **現在の状態 (`util_clear_old_verification_images.md`)**:
    - ファイルのリネームに伴い、`.gitignore` の 40行目に以下の記述が追加されました：
      ```gitignore
      .agent/workflows/util_clear_old_verification_images.md
      ```
    - この行により、当該ファイルは**明示的に無視**される設定となりました。
    - Antigravity（および多くのVSCode拡張機能）は、`.gitignore` で無視されたファイルをインデックス作成や検索の対象から除外します。そのため、ファイルが存在してもスラッシュコマンドの候補に表示されなくなりました。

## 2. 質問への回答

### Q1. ファイル名を変更した際、インデックスが更新されるトリガーは何ですか？
ファイルシステムの変更イベント（作成、削除、リネーム、保存）がトリガーとなります。
リネームを行った際、システムは「新しいファイルが作成された」と認識し、即座にそのファイルが「インデックス対象かどうか（`.gitignore` に含まれているか）」を確認します。今回の場合、リネーム後のファイル名が `.gitignore` の無視リストに該当したため、インデックスから除外されました。

### Q2. 「以前は動作していた」という点から、単なるgitignoreの問題ではない可能性はありますか？（`util_` というプレフィックス自体に特別な意味がある、など）
いいえ、今回は**純粋に `.gitignore` の問題**であると断定できます。
`util_` というプレフィックス自体にシステム上の制限はありません。以前動作していたのは、当時のファイル名が `.gitignore` の「明示的な除外リスト」に含まれておらず、ディレクトリのホワイトリスト（`!.agent/workflows/`）の効果で認識されていたためです。

### Q3. ローカル情報を含むワークフローを、Git管理から外したままスラッシュコマンドとして利用するための正しい設定方法

「Gitの管理（コミット）には含めたくない」かつ「エディタやエージェントツールからは認識させたい」という要件を満たす場合、一般的な `.gitignore` による除外は使えません（ツールからも見えなくなるため）。

いくつかの解決策があります：

#### 推奨策: ファイルを「Git追跡対象外」のままにする（`.gitignore` から削除）
最もシンプルで副作用の少ない方法です。

1.  **`.gitignore` の 40行目を削除する**
    - `.agent/workflows/util_clear_old_verification_images.md` の行を消去します。
2.  **Gitのステージング（add）を行わない**
    - ファイルは `Untracked files`（未追跡ファイル）として `git status` に表示され続けますが、これを許容します。
    - これにより、エージェントやエディタはファイルを認識でき、かつリポジトリにはコミットされません。

#### 代替策: グローバル設定または `.git/info/exclude`（効果がない可能性高）
通常、`.git/info/exclude` はローカル限定の無視リストとして機能しますが、Antigravityを含む多くのツールはこれも `.gitignore` と同様に「無視すべきファイル」として扱うため、**この方法は機能しない可能性が高い**です（私が確認した際もアクセスがブロックされました）。

---

## 修正手順（推奨策の実行）

以下の手順で `.gitignore` を修正することで、即座にスラッシュコマンドとして認識されるようになります。

1. `.gitignore` ファイルを開きます。
2. 40行目の `.agent/workflows/util_clear_old_verification_images.md` を削除します。
3. ファイルを保存します。
4. チャット欄で `/` を入力し、候補に表示されるか確認します（再読み込みが必要な場合があります）。
